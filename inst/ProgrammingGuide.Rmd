---
title: "Programming Guide NetLogoR"
author: "Sarah Bauduin, Eliot McIntire"
date: "March, 7th 2016"
output: html_document
---

This document is based on the [NetLogo’s Programming Guide](https://ccl.northwestern.edu/netlogo/docs/programming.html). It describes how the NetLogo’s programming language is translated in the R language.


### World and agents

In NetLogoR, the world is a `NLworld*` object. It is either a `NLworld` or a `NLworldStack` object. The world is two dimensional and is divided into a grid of square patches. 

There are two types of agents in NetLogoR: the patches and the turtles. Patches cannot move whereas turtles can move. Patches are defined by their coordinates `pxcor` and `pycor`, representing their center, in `matrix` objects. See `help("NLworld")` for more details on the patch coordinates system. Turtles are defined by their coordinates `xcor` and `ycor` in  `SpatialPointDataFrame` objects. Patches coordinates are always integers but turtles coordinates can have decimals (i.e., a turtle can be positioned anywhere on a patch).


### Procedures

In NetLogoR, R functions act on agents. Functions can either transform agents or used them to compute some value. Functions available from the R software and different packages can be used, as well as the functions from NetLogoR. The NetLogoR functions are a translation into the R language of the NetLogo’s primitives (i.e., “built-in commands and reporters”). You can create new functions or wrap several existing functions into one. The rules to do so are imposed by the R language.  

Functions take arguments which are R objects and values. Arguments are used to carry out actions and compute results.
```{r, eval=FALSE}
w1 <- createNLworld(minPxcor = 0, maxPxcor = 10, minPycor = 0, maxPycor = 10) # create a world according to the given extent
pDist <- NLdist(world = w1, from = cbind(pxcor = 0, pycor = 0), to = cbind(pxcor = 1, pycor = 1) # report the distance between the patch [pxcor = 0, pycor = 0] and the patch [pxcor = 1, pycor = 1]
```

In NetLogoR, it is one of the function argument which specify which patch(es) or turtle(s) are involved in the function. For example, in the `NLdist` function, the argument `from` takes one patch coordinates and the argument `to` takes another patch coordinates.

The result of a function which acts on agents or computes a value need to be assigned to an object name to be kept and re-used later in the model. Functions create new objects, they do not directly modify the ones given as arguments. For example, when moving turtles around using the `fd` function, the result (i.e., the turtles with new coordinates) need to be re-assigned to the turtles object.
```{r, eval=FALSE}
t1 <- createTurtles(world = w1, n = 10) # create 10 turtles
t1 <- fd(world = w1, turtles = t1, step = 1) # move all the turtles by 1
```

In NetLogo, pressing a button runs some code. To perform the button action in NetLogoR, the code must be sent to the R console to be executed. The code can be sent directly by the observer or by a scheduler function (e.g., see SpaDES package) which sends the code according to the schedule to the R console.

The R language uses # to add comments to the script. Comments can make your code easier to read and understand, but they don't affect its behavior.


### Variables

R objects which are not worlds, patches or turtles can be seen as global variables.

Agent variables are places to store different values for an agent. An agent variable can be a patch or a turtle variable. Each `NLworld` holds only one variable for the patches. `NLworldStack` hold several variables for the patches as the different world layers. Turtles variables are columns in the dataframe of the `SpatialPointsDataFrame` object. You can have patch and turtle variables defined by the same name as they are not stored in the same object. 

To create a global variable you create an R object.  
```{r, eval=FALSE}
score <- 15
```

To create a new patch variable, you create a new `NLworld` with the same extent as the one(s) previously built and assign new values. 
```{r, eval=FALSE}
pQuality <- w1 # copy the world w1 already built
pQuality[] <- runif(n = length(w1), min = 0, max = 1) # for all patches, assign a random value between 0 and 1
```

Several turtles variables built-in into NetLogo are created as the same time when creating turtles in NetLogoR. To create a new turtle variable, ... (to complete) 
```{r, eval=FALSE}
...
```

Turtle’s breed is a turtle variable and different breeds can be defined. You can have the breeds behaving differently, for example, you could have breeds called `sheep` and `wolf`, and have the wolves try to eat the sheep. You can either specify different breeds in the same turtles object or create two objects, one sheep and one wolf.

You define turtles' breed by filling the breed column in the `SpatialPointsDataFrame`.
```{r, eval=FALSE}
turtles <- createTurtles(world = w1, n = 10, breed = c(rep("sheep", 5), rep("wolf", 5))) # 5 sheep and 5 wolves
# OR
sheep <- createTurtles(world = w1, n = 5, breed = "sheep") # 5 sheep
wolves <- createTurtles(world = w1, n = 5, breed = "wolf") # 5 wolves
```

You can after define agentsets based on breeds.
```{r, eval=FALSE}
sheep <- turtles[turtles$breed == "sheep",] # 5 sheeps
wolves <- turtles[turtles$breed == "wolf",] # 5 wolves
```

One agent can change breed. If doing so, it is better to keep all the moving agents in the same object.
```{r, eval=FALSE}
turtles[turtles$who == 0, "breed"] <- "wolf" # the turtle number 0 which was "sheep" became "wolf"
sheep[sheep$who == 0, "breed"] <- "wolf" # confusing!
```

Global variables are available for all agents. Patches and turtles variables are available to other agents if they can be identified by their coordinates or some other variables.
```{r, eval=FALSE}
pQuality[0,0] # reports the value of the patch [pxcor = 0, pycor = 0] for the variable held by pQuality. This value can then be used by any other agents
```

Local variables may occur in NetLogoR as inherent to the R software. For example, variables only defined inside functions are local variables and therefore cannot be accessed outside of the functions.


### Agentsets

The `NLworld*` object contains all patches and the `turtles` object contains all turtles. An agentset is a set of agents and you can construct agentsets that contain only some patches or some turtles. An agentset cannot contain the two agent types at once. A patch agentset is a matrix that contains some patches coordinates. A turtle agentset is a `SpatialPointDataFrame` object containing a subset of the turtles. Agentsets can then be passed on as an argument in functions. Agentsets can be redefined at any time. 


### World topology

By default, a `NLworld*` is bounded so it does not "wrap". Patches on the sides of the world will have fewer than 8 neighbors and turtles will not move beyond the edges of the world. What happen to the turtles when they reach the edge of the world must be defined. 

However you can make the world a torus (“wrap”), so that when a turtle moves past the edge of the world, it disappears and reappears on the opposite edge and every patch has the same number of neighbor patches. If you're a patch on the edge of the world, some of your neighbors are on the opposite edge. The option for a torus world is an argument in the NetLogoR functions.


### Tick counter

It is common that time passes in discrete steps.
Time can be defined as a global variable in the model setup ...
```{r, eval=FALSE}
time <- 0
```
... and then can be incremented in the model when needed (e.g., at the end of the procedure affecting all the agents).  
```{r, eval=FALSE}
time <- time + 1
```

If a scheduler function is used in the model, time is handled with the scheduling of the functions. 


### Lists and strings

Lists may be seen as global variables holding one or more values and strings may be seen as global variables holding characters. Lists and strings are inherent to the R language. Please see R manuals for any related questions.


### Math and random numbers

R is a software dedicated for data management and statistical analyses. The notation and basic rules of math, as well as the random number generation, are inherent to the software. Please see R manuals for any related questions.


### Input/output

Reading and writing files is inherent to the R language. Please see R manuals for any related questions on basic functions, as well as the different packages, for more complex functions to manage files.


### View, plot, screen output

There is no interface built-in as part of NetLogoR. 

However, you can still plot the agent positions in the world (i.e., “view” in NetLogo) as well as any other plots (e.g., the number of turtles through time ) on the R plot interface. You can also generate outputs on the screen using different functions. To do so, you need to specifically code for these procedures in the model using R functions and of different packages. Please refer to their manuals for any related questions.
